{% extends "base.html" %}
{% set active='timer' %}
{% block title %}TaskManager — Focus Timer{% endblock %}
{% block content %}
<div class="tm-form-card" style="max-width:980px;">
  <div class="d-flex justify-content-between align-items-end flex-wrap gap-2 mb-3">
    <div>
      <h1 class="tm-page-title h3 mb-1">Focus Timer</h1>
      <div class="tm-subtitle">Start a session, stay focused, and your progress will be saved automatically.</div>
    </div>

    <!-- UPDATED: Back to dashboard now looks like a proper button -->
    <a href="{{ url_for('dashboard_bp.dashboard') }}"
       class="btn btn-sm btn-outline-secondary tm-pill-btn">
      <span class="me-1">←</span> Dashboard
    </a>
  </div>

  <div class="tm-card card p-4 p-md-5 text-center">
    <div class="tm-timer" id="timerDisplay">25:00</div>
    <div class="tm-subtitle mt-1" id="timerSubtitle">Focus session</div>

    <div class="row g-3 mt-4 text-start">
      <div class="col-12 col-md-4">
        <label class="form-label">Session type</label>
        <select class="form-select" id="modeSelect">
          <option value="focus" selected>Focus</option>
          <option value="break">Break</option>
          <option value="long_break">Long break</option>
        </select>
      </div>

      <div class="col-12 col-md-4">
        <label class="form-label">Minutes</label>
        <input class="form-control" id="minutesInput" type="number" min="1" max="180" value="{{ settings.focus_minutes if settings else 25 }}">
      </div>

      <div class="col-12 col-md-4">
        <label class="form-label">Link to a task <span class="opacity-75">(optional)</span></label>
        <select class="form-select" id="taskSelect">
          <option value="">No task</option>
          {% for t in open_tasks %}
            <option value="{{ t.id }}">{{ t.title }}</option>
          {% endfor %}
        </select>
        <div class="form-text">If you link a task, Insights can show which tasks got focus time.</div>
      </div>
    </div>

    <div class="tm-btn-row d-flex justify-content-center gap-2 mt-4 flex-wrap">
      <button class="btn btn-primary" id="startBtn">Start</button>
      <button class="btn btn-outline-secondary" id="pauseBtn" disabled>Pause</button>
      <button class="btn btn-outline-danger" id="resetBtn">Reset</button>
    </div>

    <div class="alert alert-info mt-4 mb-0 text-start">
      When the countdown finishes, your session is saved automatically and you’ll be prompted to take a break.
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='timer.js') }}"></script>
{% endblock %}
