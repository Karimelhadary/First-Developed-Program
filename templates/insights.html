<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Insights — Task Management System</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="{{ url_for('static', filename='insights.css') }}" />
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light mb-3">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('splash_bp.splash') }}">TaskManager</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('dashboard_bp.dashboard') }}">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('tasks_bp.task_list') }}">Tasks</a></li>
        <li class="nav-item"><a class="nav-link active" href="{{ url_for('insights_bp.insights') }}">Insights</a></li>
      </ul>
    </div>
  </div>
</nav>

<header class="container mb-3">
  <a href="{{ url_for('dashboard_bp.dashboard') }}" class="back">← Dashboard</a>
  <h2>Your Insights</h2>
</header>

<main class="container">
  <section class="summary card p-3 mb-3 shadow-sm">
    <h3>Today's Summary</h3>
    <p>Tasks completed:
      <strong>{{ completed_tasks }}/{{ total_tasks }}</strong>
    </p>
    <p>Focus time: <strong>{{ focus_time }}</strong></p>
    <p>
      Overall progress:
      {% if total_tasks > 0 %}
        <strong>{{ (completed_tasks / total_tasks * 100)|round(0) }}%</strong>
      {% else %}
        <strong>0%</strong>
      {% endif %}
    </p>
    <p>Focus sessions logged: <strong>{{ focus_sessions }}</strong></p>
    <p>Moods logged: <strong>{{ mood_logs }}</strong></p>
  </section>

  <section class="chart card p-3 mb-3 shadow-sm">
    <h3>Progress Overview</h3>
    <canvas id="progressChart" width="500" height="250"></canvas>
  </section>

  <section class="quote card p-3 shadow-sm">
    <blockquote>“Productivity is never an accident.”</blockquote>
    <p>– Paul J. Meyer</p>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const totalTasks = {{ total_tasks|default(0) }};
  const completedTasks = {{ completed_tasks|default(0) }};
  const remainingTasks = {{ remaining_tasks|default(0) }};

  const ctx = document.getElementById('progressChart').getContext('2d');

  const data = {
    labels: ['Completed', 'Remaining'],
    datasets: [{
      label: 'Tasks',
      data: [completedTasks, remainingTasks],
      backgroundColor: ['#4a5cff', '#e5e7ff'],
      borderWidth: 1
    }]
  };

  const options = {
    responsive: true,
    plugins: {
      legend: { position: 'bottom' },
      title: { display: false }
    }
  };

  new Chart(ctx, {
    type: 'doughnut',
    data: data,
    options: options
  });
</script>
</body>
</html>